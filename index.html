<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="Ming blogs">
<meta property="og:type" content="website">
<meta property="og:title" content="Ming">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Ming">
<meta property="og:description" content="Ming blogs">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Ming">
<meta name="twitter:description" content="Ming blogs">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Ming</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Ming</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">ming</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/02/Redux-for-ReactNative/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Pu Ming">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ming">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/02/Redux-for-ReactNative/" itemprop="url">Redux for ReactNative</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-02T16:37:44+08:00">
                2017-11-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="基本理论"><a href="#基本理论" class="headerlink" title="基本理论"></a>基本理论</h1><h2 id="1-官网定义："><a href="#1-官网定义：" class="headerlink" title="1.官网定义："></a>1.官网定义：</h2><p>Redux 是 JavaScript 状态容器，提供可预测化的状态管理。可以让你构建一致化的应用，运行于不同的环境（客户端、服务器、原生应用），并且易于测试。不仅于此，它还提供 超爽的开发体验，Redux 除了和 React 一起用外，还支持其它界面库。</p>
<p>Redux就是一个state管理的库，它好比Android中的MVP架构一样，使得复杂的业务逻辑和视图状态变得简单、清晰。</p>
<h2 id="2-三个原则："><a href="#2-三个原则：" class="headerlink" title="2.三个原则："></a>2.三个原则：</h2><ul>
<li><strong>单一数据源</strong>：整个应用的state被储存在一棵 object tree 中，并且这个 object tree 只存在于唯一一个<strong>store</strong>。</li>
<li><strong>State 是只读的</strong>：惟一改变 state 的方法就是触发 <strong>action</strong>，action 是一个用于描述已发生事件的普通对象。</li>
<li><strong>使用纯函数来执行修改</strong>：在改变state tree时，用到action，同时也需要编写对应的<strong>reducers</strong>才能完成state改变操作。</li>
</ul>
<h2 id="3-Action-Reducers-Store的职责："><a href="#3-Action-Reducers-Store的职责：" class="headerlink" title="3.Action,Reducers,Store的职责："></a>3.Action,Reducers,Store的职责：</h2><h4 id="Action"><a href="#Action" class="headerlink" title="Action:"></a>Action:</h4><p>Action 是把数据从应用传到 store 的有效载荷。它是 store 数据的唯一来源。一般来说你会通过 store的dispatch() 将 action 传到 store。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dispatch(&#123;type: TYPES.FETCH_MOVE_LIST, move: data&#125;);</div></pre></td></tr></table></figure>
<p>Action 本质上是 JavaScript 普通对象。我们约定，action 内必须使用一个字符串类型的 type 字段来表示将要执行的动作。多数情况下，type 会被定义成字符串常量。当应用规模越来越大时，建议使用单独的模块或文件来存放 action。</p>
<p>Action一般由++action创建函数++生成，在 Redux 中的 action 创建函数只是简单的返回一个 action</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">export const addList = (data) =&gt; &#123;</div><div class="line">	return &#123;</div><div class="line">		type: TYPES.FETCH_MOVE_LIST,</div><div class="line">		data</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Action 创建函数可以根据自己的业务逻辑定义，也可以使用<a href="https://github.com/reduxactions/redux-actions" target="_blank" rel="external">redux-actions</a></p>
<p>store 里可以直接通过 store.dispatch() 调用 dispatch() 方法，但是实际项目中使用 <a href="https://github.com/reactjs/react-redux" target="_blank" rel="external">react-redux</a> 提供的 connect() 将Redux Store与容器组件相连接。bindActionCreators() 可以自动把多个 action 创建函数 绑定到 dispatch() 方法上。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">export default connect(</div><div class="line">  state =&gt; (&#123;</div><div class="line">    moves: state.home.data,</div><div class="line">  &#125;),</div><div class="line">  dispatch =&gt; bindActionCreators(&#123;fetchListAction: fetchList&#125;, dispatch)</div><div class="line">)(Home);</div><div class="line">//触发Action</div><div class="line">this.props.fetchListAction();</div></pre></td></tr></table></figure>
<h4 id="Reducers"><a href="#Reducers" class="headerlink" title="Reducers:"></a>Reducers:</h4><p>Reducer 就是一个纯函数，接收旧的 state 和 action，返回新的 state。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">const initialState = &#123;</div><div class="line">  isFetch: false,</div><div class="line">  data: [],</div><div class="line">  status: null,</div><div class="line">&#125;;</div><div class="line">const defaultAction = &#123;&#125;;</div><div class="line"></div><div class="line">export default function getNewState(state = initialState, action = defaultAction) &#123;</div><div class="line">  switch (action.type) &#123;</div><div class="line">    case TYPES.FETCH_MOVE_LIST:</div><div class="line">      return Object.assign(&#123;&#125;, state, &#123;</div><div class="line">        isFetch: true,</div><div class="line">        data: action.move,</div><div class="line">        status: &apos;done&apos;</div><div class="line">      &#125;);</div><div class="line">    case TYPES.FETCH_FIND_LIST:</div><div class="line">      return &#123;</div><div class="line">        ...state,</div><div class="line">        isFetch: false,</div><div class="line">        data: [],</div><div class="line">        status: null</div><div class="line">      &#125;;</div><div class="line">    default:</div><div class="line">      return state;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在实际项目中我们应该把各个模块的action分开，这样每一个action都应该对应有一个reducer,最后，Redux 提供了 combineReducers()把各个reducer合成为rootReducer</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">export default function getRootReducer() &#123;</div><div class="line">  return combineReducers(&#123;</div><div class="line">    home: HomeReducer,</div><div class="line">    nav: NavReducer,</div><div class="line">  &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>combineReducers() 所做的只是生成一个函数，这个函数来调用你的一系列 reducer，每个 reducer 根据它们的 key 来筛选出 state 中的一部分数据并处理，然后这个生成的函数再将所有 reducer 的结果合并成一个大的对象。</p>
<h4 id="Store"><a href="#Store" class="headerlink" title="Store:"></a>Store:</h4><p>Store中负责Action和Reducer的交互，并记录Reducer处理的最新State</p>
<p>Store有一下职责：</p>
<ul>
<li>维持应用的 state；</li>
<li>提供 getState() 方法获取 state；</li>
<li>提供 dispatch(action) 方法更新 state；</li>
<li>通过 subscribe(listener) 注册监听器;</li>
<li>通过 subscribe(listener) 返回的函数注销监听器。</li>
</ul>
<p>我们用createStore()函数生成一个store</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">import thunk from &apos;redux-thunk&apos;;</div><div class="line">import &#123;createStore, applyMiddleware, compose &#125; from &apos;redux&apos;;</div><div class="line">import rootReducer from &apos;../reducers&apos;;</div><div class="line"></div><div class="line">const middleware = applyMiddleware(thunk);</div><div class="line">let store = createStore(rootReducer(), undefined, middleware);</div><div class="line"></div><div class="line">export default store;</div></pre></td></tr></table></figure>
<p>最后我们用<a href="https://github.com/reactjs/react-redux" target="_blank" rel="external">react-redux</a>提供的Provider包装整个视图结构。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">render() &#123;</div><div class="line">    return (</div><div class="line">      &lt;Provider store=&#123;store&#125;&gt;</div><div class="line">        &lt;AppNavigation/&gt;</div><div class="line">      &lt;/Provider&gt;</div><div class="line">    )</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h4 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h4><p>用户行为触发Action的分发；Reducer接收Action和旧的State，并根据行为类型进行相应的逻辑处理，并返回最新State；Store中负责Action和Reducer的交互，并记录Reducer处理的最新State。并且还可以应用中间件等；此时可利用<strong>react-redux</strong>将状态与视图绑定利用<strong>redux-actions</strong>生成action和reducer利用<strong>redux-promise</strong>或<strong>redux-thunk</strong>实现异步。</p>
<h2 id="4-redux状态管理的流程"><a href="#4-redux状态管理的流程" class="headerlink" title="4.redux状态管理的流程"></a>4.redux状态管理的流程</h2><p><img src="http://upload-images.jianshu.io/upload_images/5684685-626d8bd4e4f596fe.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<h1 id="源码简单分析"><a href="#源码简单分析" class="headerlink" title="源码简单分析"></a>源码简单分析</h1><p>首先分析视图绑定库<a href="https://github.com/reactjs/react-redux" target="_blank" rel="external">react-redux</a>的源码。react-redux提供Provider, createProvider, connectAdvanced, connect这四个api,重点分析Provider，connect。</p>
<h2 id="1-Provider"><a href="#1-Provider" class="headerlink" title="1.Provider"></a>1.Provider</h2><blockquote>
<p>Provider本质就是一个普通的Component</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">export function createProvider(storeKey = &apos;store&apos;, subKey) &#123;</div><div class="line">    //...</div><div class="line">    class Provider extends Component &#123;</div><div class="line">        getChildContext() &#123;</div><div class="line">          return &#123; [storeKey]: this[storeKey], [subscriptionKey]: null &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        constructor(props, context) &#123;</div><div class="line">          super(props, context)</div><div class="line">          this[storeKey] = props.store;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        render() &#123;</div><div class="line">          return Children.only(this.props.children)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    Provider.propTypes = &#123;</div><div class="line">        store: storeShape.isRequired,</div><div class="line">        children: PropTypes.element.isRequired,</div><div class="line">    &#125;</div><div class="line">    return Provider</div><div class="line">&#125;</div><div class="line"></div><div class="line">export default createProvider()</div></pre></td></tr></table></figure>
<p>Provider是createProvider()函数的返回值，就是一个普通Component。有两个属性：store，children<br>所以使用Provider形式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">render() &#123;</div><div class="line">    return (</div><div class="line">      &lt;Provider</div><div class="line">        store=&#123;store&#125;</div><div class="line">        children=&#123;&lt;AppNavigation/&gt;</div><div class="line">        &#125;/&gt;</div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">  //或者</div><div class="line">  </div><div class="line">render() &#123;</div><div class="line">    return (</div><div class="line">      &lt;Provider store=&#123;store&#125;&gt;</div><div class="line">        &lt;AppNavigation/&gt;</div><div class="line">      &lt;/Provider&gt;</div><div class="line">    )</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h2 id="2-connect"><a href="#2-connect" class="headerlink" title="2.connect"></a>2.connect</h2><blockquote>
<p>connect函数原型function connect(mapStateToProps,mapDispatchToProps,mergeProps,{})</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">export function createConnect(&#123;</div><div class="line">  connectHOC = connectAdvanced,</div><div class="line">  mapStateToPropsFactories = defaultMapStateToPropsFactories,</div><div class="line">  mapDispatchToPropsFactories = defaultMapDispatchToPropsFactories,</div><div class="line">  mergePropsFactories = defaultMergePropsFactories,</div><div class="line">  selectorFactory = defaultSelectorFactory</div><div class="line">&#125; = &#123;&#125;) &#123;</div><div class="line">  return function connect(</div><div class="line">    mapStateToProps,</div><div class="line">    mapDispatchToProps,</div><div class="line">    mergeProps,</div><div class="line">    &#123;</div><div class="line">      pure = true,</div><div class="line">      areStatesEqual = strictEqual,</div><div class="line">      areOwnPropsEqual = shallowEqual,</div><div class="line">      areStatePropsEqual = shallowEqual,</div><div class="line">      areMergedPropsEqual = shallowEqual,</div><div class="line">      ...extraOptions</div><div class="line">    &#125; = &#123;&#125;</div><div class="line">  ) &#123;</div><div class="line">  //...</div><div class="line">  return connectHOC()</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">export default createConnect()</div></pre></td></tr></table></figure>
<p>connect是createConnect()函数的返回值，connect也是一个函数，一共有四个参数：mapStateToProps，mapDispatchToProps，mergeProps，options。返回另一个函数：function wrapWithConnect(WrappedComponent) {}</p>
<h4 id="参数："><a href="#参数：" class="headerlink" title="参数："></a>参数：</h4><ul>
<li>[mapStateToProps(state, [ownProps]): stateProps] (Function): 如果定义该参数，组件将会监听 Redux store 的变化。任何时候，只要 Redux store 发生改变，mapStateToProps 函数就会被调用。该回调函数必须返回一个纯对象，这个对象会与组件的 props 合并。如果你省略了这个参数，你的组件将不会监听 Redux store。如果指定了该回调函数中的第二个参数 ownProps，则该参数的值为传递到组件的 props，而且只要组件接收到新的 props，mapStateToProps 也会被调用。</li>
<li>[mapDispatchToProps(dispatch, [ownProps]): dispatchProps] (Object or Function): 如果传递的是一个对象，那么每个定义在该对象的函数都将被当作 Redux action creator，而且这个对象会与 Redux store 绑定在一起，其中所定义的方法名将作为属性名，合并到组件的 props 中。如果传递的是一个函数，该函数将接收一个 dispatch 函数，然后由你来决定如何返回一个对象，这个对象通过 dispatch 函数与 action creator 以某种方式绑定在一起（提示：你也许会用到 Redux 的辅助函数 bindActionCreators()）。如果你省略这个 mapDispatchToProps 参数，默认情况下，dispatch 会注入到你的组件 props 中。如果指定了该回调函数中第二个参数 ownProps，该参数的值为传递到组件的 props，而且只要组件接收到新 props，mapDispatchToProps 也会被调用。</li>
<li>[mergeProps(stateProps, dispatchProps, ownProps): props] (Function): 如果指定了这个参数，mapStateToProps() 与 mapDispatchToProps() 的执行结果和组件自身的 props 将传入到这个回调函数中。该回调函数返回的对象将作为 props 传递到被包装的组件中。你也许可以用这个回调函数，根据组件的 props 来筛选部分的 state 数据，或者把 props 中的某个特定变量与 action creator 绑定在一起。如果你省略这个参数，默认情况下返回 Object.assign({}, ownProps, stateProps, dispatchProps) 的结果。</li>
<li><p>[options] (Object) 如果指定这个参数，可以定制 connector 的行为。</p>
<p>  <strong>1.</strong>[pure = true] (Boolean): 如果为 true，connector 将执行 shouldComponentUpdate 并且浅对比 mergeProps 的结果，避免不必要的更新，前提是当前组件是一个“纯”组件，它不依赖于任何的输入或 state 而只依赖于 props 和 Redux store 的 state。默认值为 true。</p>
<p>  <strong>2.</strong>[withRef = false] (Boolean): 如果为 true，connector 会保存一个对被包装组件实例的引用，该引用通过 getWrappedInstance() 方法获得。默认值为 false</p>
</li>
</ul>
<h4 id="返回值："><a href="#返回值：" class="headerlink" title="返回值："></a>返回值：</h4><p>从源码中可以看出connect函数最后执行了connectHOC()这个函数，connectHOC是connectAdvanced所赋的值，下面是connectAdvanced函数的源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">export default function connectAdvanced(</div><div class="line">  selectorFactory,</div><div class="line">  &#123;</div><div class="line">    getDisplayName = name =&gt; `ConnectAdvanced($&#123;name&#125;)`,</div><div class="line"></div><div class="line">    methodName = &apos;connectAdvanced&apos;,</div><div class="line"></div><div class="line">    renderCountProp = undefined,</div><div class="line"></div><div class="line">    shouldHandleStateChanges = true,</div><div class="line"></div><div class="line">    storeKey = &apos;store&apos;,</div><div class="line"></div><div class="line">    withRef = false,</div><div class="line">    </div><div class="line">    ...connectOptions</div><div class="line">  &#125; = &#123;&#125;</div><div class="line">) &#123;</div><div class="line">    //...</div><div class="line">     return function wrapWithConnect(WrappedComponent) &#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>从源码中可以看出最后返回了wrapWithConnect函数。那么wrapWithConnect函数就是connect最后的返回值。</p>
<p>下面继续看一下wrapWithConnect函数的源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">function wrapWithConnect(WrappedComponent) &#123;</div><div class="line">    //...</div><div class="line">     class Connect extends Component &#123;</div><div class="line">         //...</div><div class="line">     &#125;</div><div class="line">     //...</div><div class="line">     return hoistStatics(Connect, WrappedComponent)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>从源码可以看出，wrapWithConnect函数有一个参数：WrappedComponent。这个参数其实就是一个Component，最后返回的是一个新的已与 Redux store 连接的Component。所以connect函数使用形式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">export default connect(</div><div class="line">  state =&gt; (&#123;</div><div class="line">    moves: state.home.data,</div><div class="line">  &#125;),</div><div class="line">  dispatch =&gt; bindActionCreators(&#123;fetchListAction: fetchList, fetchMore&#125;, dispatch),</div><div class="line">)(Home);</div><div class="line">//这里省略了第三参数，默认情况下返回 Object.assign(&#123;&#125;, ownProps, stateProps, dispatchProps) 的结果。</div></pre></td></tr></table></figure>
<blockquote>
<p>总结connect函数的功能：连接 React 组件与 Redux store。<br>连接操作不会改变原来的组件类，反而返回一个新的已与 Redux store 连接的组件类</p>
</blockquote>
<p>下面分析Redux源码，Redux提供５个api方法：createStore,combineReducers,bindActionCreators,applyMiddleware,compose</p>
<h2 id="3-createStore"><a href="#3-createStore" class="headerlink" title="3.createStore"></a>3.createStore</h2><blockquote>
<p>创建一个 Redux store 来以存放应用中所有的 state。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">export default function createStore(reducer, preloadedState, enhancer) &#123;</div><div class="line">    //...</div><div class="line">    function getState() &#123;</div><div class="line">    return currentState</div><div class="line">  &#125;</div><div class="line">   //...</div><div class="line">  function subscribe(listener) &#123;</div><div class="line">    //...</div><div class="line">  &#125;</div><div class="line">   //...</div><div class="line">  function dispatch(action) &#123;</div><div class="line">    //...</div><div class="line">    return action</div><div class="line">   &#125;</div><div class="line">   //...</div><div class="line">    function replaceReducer(nextReducer) &#123;</div><div class="line">    if (typeof nextReducer !== &apos;function&apos;) &#123;</div><div class="line">      throw new Error(&apos;Expected the nextReducer to be a function.&apos;)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    currentReducer = nextReducer</div><div class="line">    dispatch(&#123; type: ActionTypes.INIT &#125;)</div><div class="line">  &#125;</div><div class="line">  //...</div><div class="line">  return &#123;</div><div class="line">    dispatch,</div><div class="line">    subscribe,</div><div class="line">    getState,</div><div class="line">    replaceReducer,</div><div class="line">    [$$observable]: observable</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>从源码中可以看出createStore函数接收三个参数返回一个store对象。store对象又有５个方法： dispatch,subscribe,getState,replaceReducer,[$$observable]: observable</p>
<h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><ul>
<li><p>reducer (Function): 接收两个参数，分别是当前的 state 树和要处理的 action，返回新的 state 树。</p>
</li>
<li><p>[initialState] (any): 初始时的 state。 如果你使用 combineReducers 创建 reducer，它必须是一个普通对象，与传入的 keys 保持同样的结构。否则，你可以自由传入任何 reducer 可理解的内容。</p>
</li>
<li><p>enhancer (Function): Store enhancer 是一个组合 store creator 的高阶函数，返回一个新的强化过的 store creator。这与 middleware 相似，它也允许你通过复合函数改变 store 接口。一般是applyMiddleware函数的返回值。</p>
</li>
</ul>
<h4 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h4><p>(Store对象): 保存了应用所有 state 的对象。改变 state 的惟一方法是 dispatch action。你也可以 subscribe 监听 state 的变化，然后更新 UI。</p>
<h2 id="4-Store的方法"><a href="#4-Store的方法" class="headerlink" title="4.Store的方法"></a>4.Store的方法</h2><ul>
<li>getState()</li>
</ul>
<blockquote>
<p>返回应用当前的 state 树。<br>它与 store 的最后一个 reducer 返回值相同。</p>
</blockquote>
<h4 id="返回值：-1"><a href="#返回值：-1" class="headerlink" title="返回值："></a>返回值：</h4><p>(any): 应用当前的 state 树。</p>
<ul>
<li>dispatch(action)</li>
</ul>
<blockquote>
<p>分发 action。这是触发 state 变化的惟一途径。</p>
<p>会使用当前 getState() 的结果和传入的 action 以同步方式的调用 store 的 reduce 函数。返回值会被作为下一个 state。从现在开始，这就成为了 getState() 的返回值，同时变化监听器(change listener)会被触发。</p>
</blockquote>
<h4 id="参数：-1"><a href="#参数：-1" class="headerlink" title="参数："></a>参数：</h4><ol>
<li>action (Object†): 描述应用变化的普通对象。</li>
</ol>
<h4 id="返回值：-2"><a href="#返回值：-2" class="headerlink" title="返回值："></a>返回值：</h4><p>(Object): 要 dispatch 的 action。</p>
<ul>
<li>subscribe(listener)</li>
</ul>
<blockquote>
<p>添加一个变化监听器。每当 dispatch action 的时候就会执行，state 树中的一部分可能已经变化。你可以在回调函数里调用 getState() 来拿到当前 state。</p>
<p>这是一个底层 API。多数情况下，你不会直接使用它，会使用一些 React（或其它库）的绑定。如果你想让回调函数执行的时候使用当前的 state，你可以 把 store 转换成一个 Observable 或者写一个定制的 observeStore 工具。</p>
<p>如果需要解绑这个变化监听器，执行 subscribe 返回的函数即可。</p>
</blockquote>
<h4 id="参数：-2"><a href="#参数：-2" class="headerlink" title="参数："></a>参数：</h4><ol>
<li>listener (Function): 每当 dispatch action 的时候都会执行的回调。state 树中的一部分可能已经变化。你可以在回调函数里调用 getState() 来拿到当前 state。store 的 reducer 应该是纯函数，因此你可能需要对 state 树中的引用做深度比较来确定它的值是否有变化。<h4 id="返回值：-3"><a href="#返回值：-3" class="headerlink" title="返回值："></a>返回值：</h4></li>
</ol>
<p>(Function): 一个可以解绑变化监听器的函数</p>
<ul>
<li>replaceReducer(nextReducer)</li>
</ul>
<blockquote>
<p>替换 store 当前用来计算 state 的 reducer。</p>
<p>这是一个高级 API。只有在你需要实现代码分隔，而且需要立即加载一些 reducer 的时候才可能会用到它。在实现 Redux 热加载机制的时候也可能会用到。</p>
</blockquote>
<h4 id="参数：-3"><a href="#参数：-3" class="headerlink" title="参数："></a>参数：</h4><ol>
<li>reducer (Function) store 会使用的下一个 reducer。</li>
</ol>
<h2 id="5-applyMiddleware"><a href="#5-applyMiddleware" class="headerlink" title="5.applyMiddleware"></a>5.applyMiddleware</h2><blockquote>
<p>使用包含自定义功能的 middleware 来扩展 Redux 是一种推荐的方式。Middleware 可以让你包装 store 的 dispatch 方法来达到你想要的目的。同时， middleware 还拥有“可组合”这一关键特性。多个 middleware 可以被组合到一起使用，形成 middleware 链。其中，每个 middleware 都不需要关心链中它前后的 middleware 的任何信息。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">export default function applyMiddleware(...middlewares) &#123;</div><div class="line">  return (createStore) =&gt; (reducer, preloadedState, enhancer) =&gt; &#123;</div><div class="line">    const store = createStore(reducer, preloadedState, enhancer)</div><div class="line">    let dispatch = store.dispatch</div><div class="line">    let chain = []</div><div class="line"></div><div class="line">    const middlewareAPI = &#123;</div><div class="line">      getState: store.getState,</div><div class="line">      dispatch: (action) =&gt; dispatch(action)</div><div class="line">    &#125;</div><div class="line">    chain = middlewares.map(middleware =&gt; middleware(middlewareAPI))</div><div class="line">    dispatch = compose(...chain)(store.dispatch)</div><div class="line"></div><div class="line">    return &#123;</div><div class="line">      ...store,</div><div class="line">      dispatch</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="参数-1"><a href="#参数-1" class="headerlink" title="参数"></a>参数</h4><ul>
<li>…middlewares (arguments): 遵循 Redux middleware API 的函数。每个 middleware 接受 Store 的 dispatch 和 getState 函数作为命名参数，并返回一个函数。该函数会被传入 被称为 next 的下一个 middleware 的 dispatch 方法，并返回一个接收 action 的新函数，这个函数可以直接调用 next(action)，或者在其他需要的时刻调用，甚至根本不去调用它。调用链中最后一个 middleware 会接受真实的 store 的 dispatch 方法作为 next 参数，并借此结束调用链。所以，middleware 的函数签名是 ({ getState, dispatch }) =&gt; next =&gt; action。</li>
</ul>
<h4 id="返回值-1"><a href="#返回值-1" class="headerlink" title="返回值"></a>返回值</h4><p>(Function) 一个应用了 middleware 后的 store enhancer。这个 store enhancer 就是一个函数，并且需要应用到 createStore。它会返回一个应用了 middleware 的新的 createStore。</p>
<h2 id="6-combineReducers"><a href="#6-combineReducers" class="headerlink" title="6.combineReducers"></a>6.combineReducers</h2><blockquote>
<p>随着应用变得复杂，需要对 reducer 函数 进行拆分，拆分后的每一块独立负责管理 state 的一部分。</p>
<p>combineReducers 辅助函数的作用是，把一个由多个不同 reducer 函数作为 value 的 object，合并成一个最终的 reducer 函数，然后就可以对这个 reducer 调用 createStore。</p>
<p>合并后的 reducer 可以调用各个子 reducer，并把它们的结果合并成一个 state 对象。state 对象的结构由传入的多个 reducer 的 key 决定。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">export default function combineReducers(reducers) &#123;</div><div class="line">  const reducerKeys = Object.keys(reducers)</div><div class="line">  const finalReducers = &#123;&#125;</div><div class="line">  for (let i = 0; i &lt; reducerKeys.length; i++) &#123;</div><div class="line">    const key = reducerKeys[i]</div><div class="line"></div><div class="line">    if (process.env.NODE_ENV !== &apos;production&apos;) &#123;</div><div class="line">      if (typeof reducers[key] === &apos;undefined&apos;) &#123;</div><div class="line">        warning(`No reducer provided for key &quot;$&#123;key&#125;&quot;`)</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    if (typeof reducers[key] === &apos;function&apos;) &#123;</div><div class="line">      finalReducers[key] = reducers[key]</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  const finalReducerKeys = Object.keys(finalReducers)</div><div class="line"></div><div class="line">  let unexpectedKeyCache</div><div class="line">  if (process.env.NODE_ENV !== &apos;production&apos;) &#123;</div><div class="line">    unexpectedKeyCache = &#123;&#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  let shapeAssertionError</div><div class="line">  try &#123;</div><div class="line">    assertReducerShape(finalReducers)</div><div class="line">  &#125; catch (e) &#123;</div><div class="line">    shapeAssertionError = e</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  return function combination(state = &#123;&#125;, action) &#123;</div><div class="line">    //...</div><div class="line">    return hasChanged ? nextState : state  </div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>从源码看出combineReducers函数接收一个参数：reducers，返回一个函数。</p>
<h4 id="参数-2"><a href="#参数-2" class="headerlink" title="参数"></a>参数</h4><ul>
<li>reducers (Object): 一个对象，它的值（value） 对应不同的 reducer 函数，这些 reducer 函数后面会被合并成一个。</li>
</ul>
<h4 id="返回值-2"><a href="#返回值-2" class="headerlink" title="返回值"></a>返回值</h4><p>(Function)：一个调用 reducers 对象里所有 reducer 的 reducer，并且构造一个与 reducers 对象结构相同的 state 对象。</p>
<h2 id="7-bindActionCreators"><a href="#7-bindActionCreators" class="headerlink" title="7.bindActionCreators"></a>7.bindActionCreators</h2><blockquote>
<p>把 action creators 转成拥有同名 keys 的对象，但使用 dispatch 把每个 action creator 包围起来，这样可以直接调用它们。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">export default function bindActionCreators(actionCreators, dispatch) &#123;</div><div class="line">  if (typeof actionCreators === &apos;function&apos;) &#123;</div><div class="line">    return bindActionCreator(actionCreators, dispatch)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  if (typeof actionCreators !== &apos;object&apos; || actionCreators === null) &#123;</div><div class="line">    throw new Error(</div><div class="line">      `bindActionCreators expected an object or a function, instead received $&#123;actionCreators === null ? &apos;null&apos; : typeof actionCreators&#125;. ` +</div><div class="line">      `Did you write &quot;import ActionCreators from&quot; instead of &quot;import * as ActionCreators from&quot;?`</div><div class="line">    )</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  const keys = Object.keys(actionCreators)</div><div class="line">  const boundActionCreators = &#123;&#125;</div><div class="line">  for (let i = 0; i &lt; keys.length; i++) &#123;</div><div class="line">    const key = keys[i]</div><div class="line">    const actionCreator = actionCreators[key]</div><div class="line">    if (typeof actionCreator === &apos;function&apos;) &#123;</div><div class="line">      boundActionCreators[key] = bindActionCreator(actionCreator, dispatch)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  return boundActionCreators</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="参数-3"><a href="#参数-3" class="headerlink" title="参数"></a>参数</h4><ul>
<li><p>actionCreators (Function or Object): 一个 action creator，或者键值是 action creators 的对象。</p>
</li>
<li><p>dispatch (Function): 一个 dispatch 函数，由 Store 实例提供。</p>
</li>
</ul>
<h4 id="返回值-3"><a href="#返回值-3" class="headerlink" title="返回值"></a>返回值</h4><p>(Function or Object): 一个与原对象类似的对象，只不过这个对象中的的每个函数值都可以直接 dispatch action。如果传入的是一个函数，返回的也是一个函数。</p>
<p><a href="https://github.com/RN-TV/Redux.git" target="_blank" rel="external">Demo</a></p>
<p><a href="http://redux.js.org/" target="_blank" rel="external">官方文档</a></p>
<p><a href="http://www.redux.org.cn/" target="_blank" rel="external">中文文档</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/02/ReactNavigation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Pu Ming">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ming">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/02/ReactNavigation/" itemprop="url">ReactNavigation</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-02T16:37:44+08:00">
                2017-11-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="navigation"><a href="#navigation" class="headerlink" title="navigation"></a>navigation</h1><p>在StackNavigator中注册后的组件都有navigation这个属性. navigation又有5个参数:<strong>navigate</strong>, <strong>goBack</strong>, <strong>state</strong>, <strong>setParams</strong>, <strong>dispatch</strong>, 可以在组件下console.log一下this.props就能看到.</p>
<ul>
<li>this.props.navigation.navigate(‘Two’, { name: ‘two’ }): push下一个页面</li>
</ul>
<blockquote>
<p>routeName: 注册过的目标路由名称<br>params: 传递的参数<br>action: 如果该界面是一个navigator的话，将运行这个sub-action</p>
<ul>
<li>this.props.navigation.goBack(): 返回上一页</li>
</ul>
</blockquote>
<ul>
<li>this.props.navigation.state: 每个界面通过这去访问它的router，state其中包括了：</li>
</ul>
<blockquote>
<p>routeName: 路由名<br>key: 路由身份标识<br>params: 参数</p>
</blockquote>
<ul>
<li><p>this.props.navigation.setParams: 该方法允许界面更改router中的参数，可以用来动态的更改导航栏的内容</p>
</li>
<li><p>this.props.navigation.dispatch: 可以dispatch一些action，主要支持的action有：</p>
<h6 id="1-navigate"><a href="#1-navigate" class="headerlink" title="1. navigate"></a>1. navigate</h6></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">import &#123; NavigationActions &#125; from &apos;react-navigation&apos;</div><div class="line"></div><div class="line">  const navigationAction = NavigationActions.navigate(&#123;</div><div class="line">    routeName: &apos;Profile&apos;,</div><div class="line">    params: &#123;&#125;,</div><div class="line"></div><div class="line">    // navigate can have a nested navigate action that will be run inside the child router</div><div class="line">    action: NavigationActions.navigate(&#123; routeName: &apos;SubProfileRoute&apos;&#125;)</div><div class="line">  &#125;)</div><div class="line">  this.props.navigation.dispatch(navigationAction)。</div></pre></td></tr></table></figure>
<h6 id="2-reset"><a href="#2-reset" class="headerlink" title="2. reset"></a>2. reset</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">import &#123; NavigationActions &#125; from &apos;react-navigation&apos;</div><div class="line"></div><div class="line">  const resetAction = NavigationActions.reset(&#123;</div><div class="line">    index: 0,</div><div class="line">    actions: [</div><div class="line">      NavigationActions.navigate(&#123; routeName: &apos;Profile&apos;&#125;),</div><div class="line">      NavigationActions.navigate(&#123; routeName: &apos;Two&apos;&#125;)</div><div class="line">    ]</div><div class="line">  &#125;)</div><div class="line">  this.props.navigation.dispatch(resetAction)</div></pre></td></tr></table></figure>
<h6 id="3-setParams"><a href="#3-setParams" class="headerlink" title="3. setParams"></a>3. setParams</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">import &#123; NavigationActions &#125; from &apos;react-navigation&apos;</div><div class="line"></div><div class="line">  const setParamsAction = NavigationActions.setParams(&#123;</div><div class="line">    params: &#123;&#125;, // these are the new params that will be merged into the existing route params</div><div class="line">    // The key of the route that should get the new params</div><div class="line">    key: &apos;screen-123&apos;,</div><div class="line">  &#125;)</div><div class="line">  this.props.navigation.dispatch(setParamsAction)</div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/17/Annotation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Pu Ming">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ming">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/01/17/Annotation/" itemprop="url">Java注解</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-01-17T16:37:44+08:00">
                2017-01-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Java-注解"><a href="#Java-注解" class="headerlink" title="Java 注解"></a>Java 注解</h1><h2 id="元注解："><a href="#元注解：" class="headerlink" title="元注解："></a>元注解：</h2><p>元注解的作用就是负责注解其他注解。Java5.0定义了4个标准的meta-annotation类型，它们被用来提供对其它 annotation类型作说明。Java5.0定义的元注解：</p>
<ul>
<li>1.@Target</li>
<li>2.@Retention</li>
<li>3.@Documented</li>
<li>4.@Inherited</li>
</ul>
<p>这些类型和它们所支持的类在java.lang.annotation包中可以找到。下面我们看一下每个元注解的作用和相应分参数的使用说明。</p>
<h4 id="Target："><a href="#Target：" class="headerlink" title="@Target："></a>@Target：</h4><p>@Target说明了Annotation所修饰的对象范围：Annotation可被用于 packages、types（类、接口、枚举、Annotation类型）、类型成员（方法、构造方法、成员变量、枚举值）、方法参数和本地变量（如循环变量、catch参数）。在Annotation类型的声明中使用了target可更加明晰其修饰的目标。</p>
<p>作用：用于描述注解的使用范围（即：被描述的注解可以用在什么地方）</p>
<p>取值(ElementType)有：</p>
<ul>
<li>1.CONSTRUCTOR:用于描述构造器</li>
<li>2.FIELD:用于描述域</li>
<li>3.LOCAL_VARIABLE:用于描述局部变量</li>
<li>4.METHOD:用于描述方法</li>
<li>5.PACKAGE:用于描述包</li>
<li>6.PARAMETER:用于描述参数</li>
<li>7.TYPE:用于描述类、接口(包括注解类型) 或enum声明</li>
</ul>
<p>使用实例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">@Target(ElementType.TYPE)</div><div class="line">public @interface Table &#123;</div><div class="line">    /**</div><div class="line">     * 数据表名称注解，默认值为类名称</div><div class="line">     * @return</div><div class="line">     */</div><div class="line">    public String tableName() default &quot;className&quot;;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@Target(ElementType.FIELD)</div><div class="line">public @interface NoDBColumn &#123;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>注解Table 可以用于注解类、接口(包括注解类型)或enum声明,而注解NoDBColumn仅可用于注解类的成员变量。</p>
<h3 id="Retention："><a href="#Retention：" class="headerlink" title="@Retention："></a>@Retention：</h3><p>@Retention定义了该Annotation被保留的时间长短：某些Annotation仅出现在源代码中，而被编译器丢弃；而另一些却被编译在class文件中；编译在class文件中的Annotation可能会被虚拟机忽略，而另一些在class被装载时将被读取（请注意并不影响class的执行，因为Annotation与class在使用上是被分离的）。使用这个meta-Annotation可以对 Annotation的“生命周期”限制。</p>
<p>作用：表示需要在什么级别保存该注释信息，用于描述注解的生命周期（即：被描述的注解在什么范围内有效）</p>
<p>取值（RetentionPoicy）有：</p>
<ul>
<li>1.SOURCE:在源文件中有效（即源文件保留）</li>
<li>2.CLASS:在class文件中有效（即class保留）</li>
<li>3.RUNTIME:在运行时有效（即运行时保留）</li>
</ul>
<p>Retention meta-annotation类型有唯一的value作为成员，它的取值来自java.lang.annotation.RetentionPolicy的枚举类型值。具体实例如下：<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">@Target(ElementType.FIELD)</div><div class="line">@Retention(RetentionPolicy.RUNTIME)</div><div class="line">public @interface Column &#123;</div><div class="line">    public String name() default &quot;fieldName&quot;;</div><div class="line">    public String setFuncName() default &quot;setField&quot;;</div><div class="line">    public String getFuncName() default &quot;getField&quot;; </div><div class="line">    public boolean defaultDBValue() default false;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Column注解的的RetentionPolicy的属性值是RUTIME,这样注解处理器可以通过反射，获取到该注解的属性值，从而去做一些运行时的逻辑处理</p>
<h3 id="Documented"><a href="#Documented" class="headerlink" title="@Documented:"></a>@Documented:</h3><p>@Documented用于描述其它类型的annotation应该被作为被标注的程序成员的公共API，因此可以被例如javadoc此类的工具文档化。Documented是一个标记注解，没有成员。</p>
<p>具体实例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">@Target(ElementType.FIELD)</div><div class="line">@Retention(RetentionPolicy.RUNTIME)</div><div class="line">@Documented</div><div class="line">public @interface Column &#123;</div><div class="line">    public String name() default &quot;fieldName&quot;;</div><div class="line">    public String setFuncName() default &quot;setField&quot;;</div><div class="line">    public String getFuncName() default &quot;getField&quot;; </div><div class="line">    public boolean defaultDBValue() default false;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="Inherited："><a href="#Inherited：" class="headerlink" title="@Inherited："></a>@Inherited：</h3><p>@Inherited 元注解是一个标记注解，@Inherited阐述了某个被标注的类型是被继承的。如果一个使用了@Inherited修饰的annotation类型被用于一个class，则这个annotation将被用于该class的子类。</p>
<p>注意：@Inherited annotation类型是被标注过的class的子类所继承。类并不从它所实现的接口继承annotation，方法并不从它所重载的方法继承annotation。</p>
<p>当@Inherited annotation类型标注的annotation的Retention是RetentionPolicy.RUNTIME，则反射API增强了这种继承性。如果我们使用java.lang.reflect去查询一个@Inherited annotation类型的annotation时，反射代码检查将展开工作：检查class和其父类，直到发现指定的annotation类型被发现，或者到达类继承结构的顶层。</p>
<p>实例代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * </div><div class="line"> * @author peida</div><div class="line"> *</div><div class="line"> */</div><div class="line">@Inherited</div><div class="line">public @interface Greeting &#123;</div><div class="line">    public enum FontColor&#123; BULE,RED,GREEN&#125;;</div><div class="line">    String name();</div><div class="line">    FontColor fontColor() default FontColor.GREEN;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="自定义注解："><a href="#自定义注解：" class="headerlink" title="自定义注解："></a>自定义注解：</h3><p>使用@interface自定义注解时，自动继承了java.lang.annotation.Annotation接口，由编译程序自动完成其他细节。在定义注解时，不能继承其他的注解或接口。@interface用来声明一个注解，其中的每一个方法实际上是声明了一个配置参数。方法的名称就是参数的名称，返回值类型就是参数的类型（返回值类型只能是基本类型、Class、String、enum）。可以通过default来声明参数的默认值。</p>
<p>定义注解格式：public @interface 注解名 {定义体}</p>
<p>注解参数的可支持数据类型：</p>
<ul>
<li>1.所有基本数据类型（int,float,boolean,byte,double,char,long,short)</li>
<li>2.String类型</li>
<li>3.Class类型</li>
<li>4.enum类型</li>
<li>5.Annotation类型</li>
<li>6.以上所有类型的数组</li>
</ul>
<p>Annotation类型里面的参数该怎么设定: </p>
<p>第一,只能用public或默认(default)这两个访问权修饰.例如,String value();这里把方法设为defaul默认类型；　 　</p>
<p>第二,参数成员只能用基本类型byte,short,char,int,long,float,double,boolean八种基本数据类型和 String,Enum,Class,annotations等数据类型,以及这一些类型的数组.例如,String value();这里的参数成员就为String;　　</p>
<p>第三,如果只有一个参数成员,最好把参数名称设为”value”,后加小括号.例:下面的例子FruitName注解就只有一个参数成员。</p>
<p>简单的自定义注解和使用注解实例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">package annotation;</div><div class="line"></div><div class="line">import java.lang.annotation.Documented;</div><div class="line">import java.lang.annotation.ElementType;</div><div class="line">import java.lang.annotation.Retention;</div><div class="line">import java.lang.annotation.RetentionPolicy;</div><div class="line">import java.lang.annotation.Target;</div><div class="line"></div><div class="line">/**</div><div class="line"> * 水果名称注解</div><div class="line"> * @author peida</div><div class="line"> *</div><div class="line"> */</div><div class="line">@Target(ElementType.FIELD)</div><div class="line">@Retention(RetentionPolicy.RUNTIME)</div><div class="line">@Documented</div><div class="line">public @interface FruitName &#123;</div><div class="line">    String value() default &quot;&quot;;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.gif"
                alt="Pu Ming" />
            
              <p class="site-author-name" itemprop="name">Pu Ming</p>
              <p class="site-description motion-element" itemprop="description">Ming blogs</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Pu Ming</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
