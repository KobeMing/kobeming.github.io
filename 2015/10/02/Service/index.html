<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="baidu-site-verification" content="L6Lm9d5Crl"/>
  
  
  
  
  <title>Service | Ming</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="一、Service：（一）、Service 简介：1、何谓“Service”？“Service” 意思即“服务”的意思， 像 Windows 上面的服务一样，服务是在后台上运行，承担着静悄悄的不为人所注意的工作。Service运行在后台，它是不可见的、无界面的程序。Service可以在很多场合的应用中使用，比如播放多媒体的时候用户启动了其他Activity，这个时候程序要在后台继续播放；比如检测S">
<meta property="og:type" content="article">
<meta property="og:title" content="Service">
<meta property="og:url" content="http://yoursite.com/2015/10/02/Service/index.html">
<meta property="og:site_name" content="Ming">
<meta property="og:description" content="一、Service：（一）、Service 简介：1、何谓“Service”？“Service” 意思即“服务”的意思， 像 Windows 上面的服务一样，服务是在后台上运行，承担着静悄悄的不为人所注意的工作。Service运行在后台，它是不可见的、无界面的程序。Service可以在很多场合的应用中使用，比如播放多媒体的时候用户启动了其他Activity，这个时候程序要在后台继续播放；比如检测S">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2017-02-22T10:34:12.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Service">
<meta name="twitter:description" content="一、Service：（一）、Service 简介：1、何谓“Service”？“Service” 意思即“服务”的意思， 像 Windows 上面的服务一样，服务是在后台上运行，承担着静悄悄的不为人所注意的工作。Service运行在后台，它是不可见的、无界面的程序。Service可以在很多场合的应用中使用，比如播放多媒体的时候用户启动了其他Activity，这个时候程序要在后台继续播放；比如检测S">
  
    <link rel="alternative" href="/atom.xml" title="Ming" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.png">
  
  
  <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
  
      <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  
  <!-- 加载特效 -->
    <script src="/js/pace.js"></script>
    <link href="/css/pace/pace-theme-flash.css" rel="stylesheet" />
  <script>
      var yiliaConfig = {
          fancybox: true,
          animate: true,
          isHome: false,
          isPost: true,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: false
      }
  </script>
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
        <a href="/" class="profilepic">
            
            <img lazy-src="/img/avatar.jpg" class="js-avatar">
            
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">Pu Ming</a></h1>
        </hgroup>
        
        <p class="header-subtitle">ming</p>
        
        
            <form>
                <input type="text" class="st-default-search-input search" id="local-search-input" placeholder="搜索一下" autocomplete="off">
            </form>
            <div id="local-search-result"></div>
        
        
            <script type="text/javascript">
                (function() {
                    'use strict';
                    function getMatchData(keyword, data) {
                        var matchData = [];
                        for(var i =0;i<data.length;i++){
                            if(data[i].title.toLowerCase().indexOf(keyword)>=0) 
                                matchData.push(data[i])
                        }
                        return matchData;
                    }
                    var $input = $('#local-search-input');
                    var $resultContent = $('#local-search-result');
                    $input.keyup(function(){
                        $.ajax({
                            url: '/search.json',
                            dataType: "json",
                            success: function( json ) {
                                var str='<ul class=\"search-result-list\">';                
                                var keyword = $input.val().trim().toLowerCase();
                                $resultContent.innerHTML = "";
                                if ($input.val().trim().length <= 0) {
                                    $resultContent.empty();
                                    $('#switch-area').show();
                                    return;
                                }
                                var results = getMatchData(keyword, json);
                                if(results.length === 0){
                                    $resultContent.empty();
                                    $('#switch-area').show();
                                    return;
                                } 
                                for(var i =0; i<results.length; i++){
                                    str += "<li><a href='"+ results[i].url +"' class='search-result-title'>"+ results[i].title +"</a></li>";
                                }
                                str += "</ul>";
                                $resultContent.empty();
                                $resultContent.append(str);
                                $('#switch-area').hide();
                            }
                        });
                    });
                })();
            </script>
        
        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        
        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a  href="/archives/">所有文章</a></li>
                        
                            <li><a  href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fl github"  target="_blank" href="/xxxxx" title="github">github</a>
                            
                                <a class="fl weibo"  target="_blank" href="/xxxxxxxx" title="weibo">weibo</a>
                            
                                <a class="fl rss"  target="_blank" href="/atom.xml" title="rss">rss</a>
                            
                        </ul>
                    </nav>
                </section>
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        
                    </div>
                </section>
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://my.csdn.net/my/mycsdn">csdn</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://www.jianshu.com/u/343e9f257182">简书</a>
                    
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">puming</div>
                </section>
                
            </div>
        </div>
    </header>
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Pu Ming</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                
                    <img lazy-src="/img/avatar.jpg" class="js-avatar">
                
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">Pu Ming</a></h1>
            </hgroup>
            
            <p class="header-subtitle">ming</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                <div class="social">
                    
                        <a class="github" target="_blank" href="/xxxxx" title="github">github</a>
                    
                        <a class="weibo" target="_blank" href="/xxxxxxxx" title="weibo">weibo</a>
                    
                        <a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
                    
                </div>
            </nav>
        </header>                
    </div>
</nav>
      <div class="body-wrap"><article id="post-Service" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="/2015/10/02/Service/" class="article-date">
      <time datetime="2015-10-02T12:30:24.000Z" itemprop="datePublished">2015-10-02</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Service
    </h1>
  


      </header>
      
      <div class="article-info article-info-post">
        

        
        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="一、Service："><a href="#一、Service：" class="headerlink" title="一、Service："></a>一、Service：</h1><h2 id="（一）、Service-简介："><a href="#（一）、Service-简介：" class="headerlink" title="（一）、Service 简介："></a>（一）、Service 简介：</h2><p>1、何谓“Service”？<br>“Service” 意思即“服务”的意思， 像 Windows 上面的服务一样，服务是在后台上运行，承担着静悄悄的不为人所注意的工作。Service运行在后台，它是不可见的、无界面的程序。<br>Service可以在很多场合的应用中使用，比如播放多媒体的时候用户启动了其他Activity，这个时候程序要在后台继续播放；比如检测SD卡上文件的变化；再或者在后台记录用户的地理信息位置的改变；或者启动一个服务来运行并一直监听某种动作等等。</p>
<p>2、Service概念的总结：<br>Service在后台运行，不可以与用户直接交互；<br>一个服务不是一个单独的进程。服务对象本身并不意味着它是在自己的进程中运行，除非另有规定，否则它与运行程序是同在一个进程中；<br>一个服务不是一个单独的线程。Service和其他组件一样，默认情况下，Service中的所有代码都是运行在主线程中；<br>Service存在的价值虽然不如Activity那么清晰。但是一般都让Service执行耗时较长的操作。例如：播放音乐、下载文件、上传文件等等。但是因为Service默认运行在主线程中，因此不能直接用它来做耗时的请求或者动作，最好在Service中启动新线程来运行耗时的任务；<br>需要通过某一个Activity或其他Context对象来启动Service。context.startService() 或 context.bindService()；<br>Service很大程度上充当了应用程序后台线程管理器的角色。（如果Activity中新开启一个线程，当该Acitivity关闭后，该线程依然在工作，但是与开启它的Activity失去联系。也就是说此时的这个线程处于失去管理的状态。但是使用Service，则可以对后台运行的线程有效地管理。）</p>
<p>3、为什么不使用后台线程而使用Service？<br>1、Service可以放在独立的进程中，所以更安全；<br>2、使用Service可以依赖现有的binder机制，不需要在应用层面上处理线程同步的繁杂工作；<br>3、系统可以重新启动异常死去的Service。<br>4、Service 与 Activity 的相同点与不同点：<br>不同点：Activity是与用户交互的组件，即可以看到UI界面，而Service是在后台运行、无需界面；<br>相同点：使用Activity 时我们需要在配置文件中声明<activity>标签，同样的使用Service 也需要在配置文件中声明<service>标签。都具有一定的生命周期。</service></activity></p>
<h2 id="（二）、服务的分类："><a href="#（二）、服务的分类：" class="headerlink" title="（二）、服务的分类："></a>（二）、服务的分类：</h2><p>1、本地服务Local Service：<br>Local Service 用于应用程序内部。用于实现应用程序自己的一些耗时任务，比如查询升级信息，并不占用应用程序比如Activity所属线程，而是单开线程后台执行，这样用户体验比较好。</p>
<p>启动service有两种方法：<br>1）、  Context.startService()<br>                    调用者与服务之间没有关联，即使调用者退出，服务仍可运行<br>2）、  Context.bindService()<br>                    调用者与服务绑定在一起，调用者一旦退出，服务也就终止</p>
<p>A、根据启动方式将本地服务分为：启动服务Started Service和绑定服务Bound  Service。【重点】</p>
<ul>
<li><p>Started Service：被启动的服务</p>
<pre><code>- 被启动的服务是由其它组件调用startService()方法而启动的，该方法会导致被启动服务的生命周期方法onStartCommand()被回调。当服务是被启动状态后，其生命周期与启动它的组件无关，即使启动服务的组件（Activity，BroadcastReceiver）已经被销毁，该服务还可以在后台无限期运行。除非调用stopSelf()或stopService()来停止该服务。
</code></pre></li>
<li><p>Bound  Service：被绑定的服务</p>
<pre><code>- 绑定服务是允许其它应用程序绑定并且与之交互的Service的实现类。为了提供绑定，必须实现onBind()回调方法。该方法返回IBinder对象，它定义了服务类与Activity交互的程序接口。
- Activity通过bindService()方法绑定到服务类，同时Activity必须提供ServiceConnection接口的实现类，它监视Activity与服务类之间的连接。在重写ServiceConnection接口的onServiceConnected()方法时，实现了将服务类顺利赋值到了Activity中，实现了在Activity中使用该服务类并执行其中的方法。
</code></pre></li>
</ul>
<p>B、根据onStartCommand()回调方法的返回值，将Service分为粘性Service和非粘性Service：<br>onStartCommand()方法有三种返回值：</p>
<ul>
<li>START_STICKY（常量值：1）：sticky的意思是“粘性的”。使用这个返回值时，我们启动的服务跟应用程序”粘”在一起，如果在执行完onStartCommand后，服务被异常kill掉，系统会自动重启该服务。当再次启动服务时，传入的第一个参数将为null;</li>
<li>START_NOT_STICKY（常量值：2）：“非粘性的”。使用这个返回值时，如果在执行完onStartCommand后，服务被异常kill掉，系统不会自动重启该服务。</li>
<li>START_REDELIVER_INTENT（常量值：3）：重传Intent。使用这个返回值时，如果在执行完onStartCommand后，服务被异常kill掉，系统会自动重启该服务，并将Intent的值传入。</li>
</ul>
<p>【备注：】<br>以上三种情况，可以理解为发生车祸后的人：<br>START_STICKY：（常量值：1）车祸后自己苏醒，但是失忆；<br>START_NOT_STICKY：（常量值：2）车祸后再也没有苏醒；<br>START_REDELIVER_INTENT：（常量值：3）车祸后自己苏醒，依然保持记忆。<br>2、远程服务Remote Service：<br>Remote Service 用于android系统内部的应用程序之间。可以定义接口并把接口暴露出来，以便其他应用进行操作。可被其他应用程序复用，比如天气预报服务，其他应用程序不需要再写这样的服务，调用已有的即可。</p>
<h2 id="（三）、Service的生命周期："><a href="#（三）、Service的生命周期：" class="headerlink" title="（三）、Service的生命周期："></a>（三）、Service的生命周期：</h2><p>1、Started Service的生命周期：</p>
<ul>
<li>onCreate()：创建服务</li>
<li>onStartCommand()：服务开始运行（在2.0以前版本中，使用onStart()回调方法）</li>
<li>onDestroy() ：服务被停止</li>
</ul>
<p>【详细说明：】<br>在程序中调用：context.startService() 会触发执行Service生命周期中的onCreate()、onStartCommand()回调方法，此时服务就开始正式运行；<br>如果Service还没有运行，则android先调用onCreate()然后调用onStartCommand()；如果Service已经运行，则只调用onStartCommand()，所以一个Service的onStartCommand方法可能会重复调用多次；<br>如果在程序中调用：context.stopService()会触发执行Service生命周期中的onDestroy()回调方法，会让服务停止；<br>stopService()的时候直接onDestroy，如果是调用者自己直接退出而没有调用stopService()的话，Service会一直在后台运行。该Service的调用者再启动该Service后可以通过stopService关闭Service；stopSelf()<br>所以StartService的生命周期为：onCreate –&gt; onStartCommand(可多次调用) –&gt; onDestroy。</p>
<p>2、Bound Service的生命周期：</p>
<ul>
<li>onCreate()：创建服务</li>
<li>onBind()：绑定服务，服务开始运行</li>
<li>onUnbind()：取消绑定</li>
<li>onDestroy() ：服务被停止</li>
</ul>
<p>【详细说明：】<br>在程序中调用：context.bindService()会触发执行Service生命周期中的onCreate()、onBind()回调方法，此时服务开始运行；<br>onBind将返回给客户端一个IBind接口实例，IBind允许客户端回调服务的方法，比如得到Service运行的状态或其他操作。此后调用者（Context，例如Activity）会和Service绑定在一起；<br>如果调用Service的调用者Context退出了，那么会依次调用Service生命周期中的onUnbind()、onDestroy()回调方法，会让服务停止；<br>所以BindService的生命周期为：onCreate –&gt; onBind(只一次，不可多次绑定) –&gt; onUnbind –&gt; onDestory。</p>
<p> 【备注：】<br>Service是不能自己启动的，只有通过 Context 对象调用startService() 和bindService() 方法来启动。<br>在Service每一次的开启关闭过程中，只有onStartCommand()可被多次调用(通过多次startService调用)，其他onCreate()、onBind()、onUnbind()、onDestory()在一个生命周期中只能被调用一次。</p>
<p>Service可以在和多场合的应用中使用，比如播放多媒体的时候用户启动了其他Activity这个时候程序要在后台继续播放，比如检测SD卡上文件的变化，再或者在后台记录你地理信息位置的改变等等，总之服务总是藏在后头的。</p>
<p>Service和Thread的区别:</p>
<ul>
<li>Thread：Thread 是程序执行的最小单元，可以用 Thread 来执行一些异步的操作。</li>
<li>Service：Service 是android的一种机制，当它运行的时候如果是Local Service，那么对应的 Service 是运行在主进程的 main 线程上的。如果是Remote Service，那么对应的 Service 则是运行在独立进程的 main 线程上。<pre><code>Thread 的运行是独立的，也就是说当一个 Activity 被 finish 之后，如果没有主动停止 Thread 或者 Thread 里的 run 方法没有执行完毕的话，Thread 也会一直执行。因此这里会出现一个问题：当 Activity 被 finish 之后，不再持有该 Thread 的引用，也就是不能再控制该Thread。另一方面，没有办法在不同的 Activity 中对同一 Thread 进行控制。
例如：如果 一个Thread 需要每隔一段时间连接服务器校验数据，该Thread需要在后台一直运行。这时候如果创建该Thread的Activity被结束了而该Thread没有 停止，那么将没有办法再控制该Thread，除非kill掉该程序的进程。这时候如果创建并启动一个 Service ，在 Service 里面创建、运行并控制该 Thread，这样便解决了该问题(因为任何 Activity 都可以控制同一个Service，而系统也只会创建一个对应 Service 的实例)。
因此可以把 Service 想象成一种消息服务，可以在任何有 Context 的地方调用 Context.startService、Context.stopService、Context.bindService、 Context.unbindService来控制它，也可以在 Service 里注册 BroadcastReceiver，通过发送 broadcast 来达到控制的目的，这些都是 Thread 做不到的。
</code></pre></li>
</ul>
<h1 id="二、本地Service："><a href="#二、本地Service：" class="headerlink" title="二、本地Service："></a>二、本地Service：</h1><h2 id="（一）、Started-Service启动MediaPlayer播放音乐："><a href="#（一）、Started-Service启动MediaPlayer播放音乐：" class="headerlink" title="（一）、Started Service启动MediaPlayer播放音乐："></a>（一）、Started Service启动MediaPlayer播放音乐：</h2><p>1、操作步骤：<br>1、写xml布局文件；<br>2、写MainActivity文件，通过按钮点击事件启动Service；<br>3、写继承于Service的StartService类文件：重写onCreate()/onStartCommand()/onDestroy()回调方法。</p>
<p>2、XML布局文件核心代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">&lt;LinearLayoutxmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:layout_width=&quot;fill_parent&quot;</div><div class="line">    android:layout_height=&quot;fill_parent&quot;</div><div class="line">    android:orientation=&quot;vertical&quot;&gt;</div><div class="line"></div><div class="line">&lt;Button</div><div class="line">android:id=&quot;@+id/button_main_play&quot;</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:onClick=&quot;clickButton&quot;</div><div class="line">        android:text=&quot;播放音乐&quot;/&gt;</div><div class="line"></div><div class="line">&lt;Button</div><div class="line">android:id=&quot;@+id/button_main_pause&quot;</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:onClick=&quot;clickButton&quot;</div><div class="line">        android:text=&quot;暂停音乐&quot;/&gt;</div><div class="line"></div><div class="line">&lt;Button</div><div class="line">android:id=&quot;@+id/button_main_stop&quot;</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:onClick=&quot;clickButton&quot;</div><div class="line">        android:text=&quot;停止音乐&quot;/&gt;</div><div class="line"></div><div class="line">&lt;Button</div><div class="line">android:id=&quot;@+id/button_main_exit&quot;</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:onClick=&quot;clickButton&quot;</div><div class="line">        android:text=&quot;关闭当前窗体&quot;/&gt;</div><div class="line"></div><div class="line">&lt;Button</div><div class="line">android:id=&quot;@+id/button_main_stopservice&quot;</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:onClick=&quot;clickButton&quot;</div><div class="line">        android:text=&quot;停止服务&quot;/&gt;</div><div class="line"></div><div class="line">&lt;/LinearLayout&gt;</div></pre></td></tr></table></figure>
<p>3、MainActivty核心代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">publicclass MainActivity extends Activity &#123;</div><div class="line">privatestaticfinal String TAG = &quot;MainActivity&quot;;</div><div class="line">private Intent intent = null;</div><div class="line">   @Override</div><div class="line">protectedvoid onCreate(Bundle savedInstanceState) &#123;</div><div class="line">           Log.i (TAG, &quot;==onCreate执行&quot;);</div><div class="line">super.onCreate(savedInstanceState);</div><div class="line">           setContentView(R.layout.activity_main);</div><div class="line">intent = new Intent(this, StartServicePlayMusic.class);</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   @Override</div><div class="line">protectedvoid onDestroy() &#123;</div><div class="line">           Log.i (&quot;MainActivty&quot;, &quot;==onDestroy()&quot;);</div><div class="line">super.onDestroy();</div><div class="line">if (intent != null) &#123;</div><div class="line">                // 停止服务可以通过stopService(intent)来停止，也可以intent到Service程序中，通过stopSelf()来停止。</div><div class="line">                stopService(intent);</div><div class="line">           &#125;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">publicvoid clickButton(View view) &#123;</div><div class="line">int type = 0;</div><div class="line">switch (view.getId()) &#123;</div><div class="line">case R.id.button_main_play:</div><div class="line">                   type = 1;</div><div class="line">break;</div><div class="line">case R.id.button_main_pause:</div><div class="line">                   type = 2;</div><div class="line">break;</div><div class="line">case R.id.button_main_stop:</div><div class="line">                   type = 3;</div><div class="line">break;</div><div class="line">case R.id.button_main_exit:</div><div class="line">                   finish();</div><div class="line">break;</div><div class="line">case R.id.button_main_stopservice:</div><div class="line">                    // 停止服务可以通过stopService(intent)来停止，也可以intent到Service程序中，通过stopSelf()来停止</div><div class="line">                    // stopService(intent);</div><div class="line">                    // finish();</div><div class="line">                   type = 4;</div><div class="line">break;</div><div class="line">           &#125;</div><div class="line">           Bundle bundle = new Bundle();</div><div class="line">           bundle.putInt(&quot;type&quot;, type);</div><div class="line">intent.putExtras(bundle);</div><div class="line">           startService(intent);</div><div class="line">   &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>4、StartServicePlayMusic核心代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div></pre></td><td class="code"><pre><div class="line">publicclass StartServicePlayMusic extends Service &#123;</div><div class="line">privatestaticfinal String TAG = &quot;StartServicePlayMusic&quot;;</div><div class="line">private MediaPlayer mediaPlayer;</div><div class="line"></div><div class="line">   @Override</div><div class="line">public IBinder onBind(Intent intent) &#123;</div><div class="line">           Log.i (TAG, &quot;==onBind执行&quot;);</div><div class="line">returnnull;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   @Override</div><div class="line">publicvoid onCreate() &#123;</div><div class="line">           Log.i (TAG, &quot;==onCreate执行&quot;);</div><div class="line">super.onCreate();</div><div class="line">if (mediaPlayer == null) &#123;</div><div class="line">mediaPlayer = MediaPlayer.create(this, R.raw.hitta);</div><div class="line">mediaPlayer.setLooping(false);</div><div class="line">           &#125;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   @Override</div><div class="line">publicint onStartCommand(Intent intent, int flags, int startId) &#123;</div><div class="line">           Log.i (TAG, &quot;==onStartCommand执行&quot;);</div><div class="line">if (intent != null) &#123;</div><div class="line">                   Bundle bundle = intent.getExtras();</div><div class="line">int type = bundle.getInt(&quot;type&quot;);</div><div class="line">switch (type) &#123;</div><div class="line">case 1:</div><div class="line">                           play();</div><div class="line">break;</div><div class="line">case 2:</div><div class="line">                           pause();</div><div class="line">break;</div><div class="line">case 3:</div><div class="line">                           stop();</div><div class="line">break;</div><div class="line">case 4:</div><div class="line">                           stopSelf();</div><div class="line">break;</div><div class="line">                   &#125;</div><div class="line">           &#125;</div><div class="line">              returnSTART_STICKY;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">   @Override</div><div class="line">publicvoid onDestroy() &#123;</div><div class="line">             Log.i (TAG, &quot;==onDestroy执行&quot;);</div><div class="line">super.onDestroy();</div><div class="line">if (mediaPlayer != null) &#123;</div><div class="line">mediaPlayer.stop();</div><div class="line">mediaPlayer.release();</div><div class="line">           &#125;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">publicvoid play() &#123;</div><div class="line">if (!mediaPlayer.isPlaying()) &#123;</div><div class="line">mediaPlayer.start();</div><div class="line">           &#125;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">publicvoid pause() &#123;</div><div class="line">if (mediaPlayer.isPlaying()) &#123;</div><div class="line">mediaPlayer.pause();</div><div class="line">           &#125;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">publicvoid stop() &#123;</div><div class="line">if (mediaPlayer != null) &#123;</div><div class="line">mediaPlayer.stop();</div><div class="line">           &#125;</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>5、Manifest清单配置文件核心代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;service </div><div class="line"></div><div class="line">android:name=&quot;.StartServicePlayMusic&quot;&gt;</div><div class="line">&lt;intent-filter&gt;</div><div class="line">&lt;actionandroid:name=&quot;com.steven.startservice.playmusic&quot;/&gt;</div><div class="line">&lt;/intent-filter&gt;</div><div class="line">&lt;/service&gt;</div><div class="line">android:name=&quot;.StartServicePlayMusic&quot;&gt;</div><div class="line">&lt;intent-filter&gt;</div><div class="line">&lt;actionandroid:name=&quot;com.steven.startservice.playmusic&quot;/&gt;</div><div class="line">&lt;/intent-filter&gt;</div><div class="line">&lt;/service&gt;</div></pre></td></tr></table></figure>
<p>6、Started  Service总结：<br>Activity页面中需要startService(intent) 和 stopService(intent)两个方法来启动Service和停止Service;<br>继承于Service类的自定义子类——MyStartService类中，生命周期回调方法有：onCreate() 、onStartCommand() 、onDestroy()；<br>如果停止服务，可以在Activity中调用stopService(intent)，也可以intent到Service中执行stopSelf()方法；<br>执行停止服务方法，会回调Service生命周期中的onDestroy()方法；<br>如果希望关闭Activity窗体，服务也停止，那么在Activity的onDestroy()方法中执行stopService()方法。如果希望关闭窗体后，服务还继续，那么Activity的onDestroy()中不执行停止服务即可；<br>在StartService中不会回调onBind()方法；<br>在停止服务后，如果再次点击“播放”，可以重新启动StartService。</p>
<p>7、IntentService与Service：</p>
<p>不管是何种Service，它默认都是在应用程序的主线程（亦即UI线程）中运行的。所以，如果你的Service将要运行非常耗时或者可能被阻塞的操作时，你的应用程序将会被挂起，甚至会出现ANR错误。为了避免这一问题，你应该在Service中重新启动一个新的线程来进行这些操作。现有两种方法大家参考：</p>
<ol>
<li><p>直接在Service的onStartCommand()方法中新建一个线程来执行;</p>
</li>
<li><p>Android SDK 中为我们提供了一个现成的Service类来实现这个功能，它就是IntentService，它主要负责以下几个方面：<br>Creates a default worker thread that executes all intents delivered to onStartCommand() separate from your application’s main thread.<br> 生成一个默认的且与主线程互相独立的工作者线程来执行所有传送至 onStartCommand() 方法的Intetnt<br>Creates a work queue that passes one intent at a time to your onHandleIntent() implementation, so you never have to worry about multi-threading.<br> 生成一个工作队列来传送Intent对象给你的onHandleIntent()方法，同一时刻只传送一个Intent对象，这样一来，你就不必担心多线程的问题。<br>Stops the service after all start requests have been handled, so you never have to call stopSelf().<br> 在所有的请求(Intent)都被执行完以后会自动停止服务，所以，你不需要自己去调用stopSelf()方法来停止该服务<br>Provides default implementation of onBind() that returns null.<br> 提供了一个onBind()方法的默认实现，它返回null<br>Provides a default implementation of onStartCommand() that sends the intent to the work queue and then to your onHandleIntent() implementation<br> 提供了一个onStartCommand()方法的默认实现，它将Intent先传送至工作队列，然后从工作队列中每次取出一个传送至onHandleIntent()方法，在该方法中对Intent对相应的处理</p>
</li>
</ol>
<p>IntentService使用队列的方式将请求的Intent加入队列，然后开启一个worker thread(线程)来处理队列中的Intent，对于异步的startService请求，IntentService会处理完成一个之后再处理第二个，每一个请求都会在一个单独的worker thread中处理，不会阻塞应用程序的主线程。<br>这里就给我们提供了一个思路，如果有耗时的操作可以在Service里面开启新线程，也可以使用IntentService来处理耗时操作。 但你若是想在Service中让多个线程并发的话，就得使用第一种方法，在Service内部起多个线程，但是这样的话，你可要处理好线程的同步。</p>
<p>（1）、Service实现加载图片的核心代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">publicclass DownloadService extends IntentService &#123;</div><div class="line">privatestaticfinal String TAG = &quot;DownloadService&quot;;</div><div class="line">private String urlString = &quot;https://www.google.com.hk/images/srpr/logo11w.png&quot;;</div><div class="line">private NotificationCompat.Builder builder = null;</div><div class="line">private NotificationManager manager = null;</div><div class="line"></div><div class="line">public DownloadService() &#123;</div><div class="line">super(&quot;&quot;);</div><div class="line">     &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">protectedvoid onHandleIntent(Intent intent) &#123;</div><div class="line">manager = (NotificationManager) getSystemService(NOTIFICATION_SERVICE);</div><div class="line">builder = new NotificationCompat.Builder(getApplicationContext());</div><div class="line">builder.setSmallIcon(R.drawable.ic_launcher);</div><div class="line">builder.setContentTitle(&quot;提示：&quot;);</div><div class="line">builder.setContentText(&quot;图片加载完成，请点击查看！&quot;);</div><div class="line">builder.setTicker(&quot;图片加载完成&quot;);</div><div class="line">builder.setAutoCancel(true);</div><div class="line">             Intent intent2 = new Intent(getApplicationContext(), MainActivity.class);</div><div class="line">             intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);</div><div class="line">             PendingIntent pIntent = PendingIntent.getActivity(getApplicationContext(), 0, intent2,</div><div class="line">                             PendingIntent.FLAG_ONE_SHOT);</div><div class="line">builder.setContentIntent(pIntent);</div><div class="line"></div><div class="line">byte[] data = HttpClientHelper.loadByteFromURL(urlString);</div><div class="line">boolean flag = SDCardHelper.saveFileToSDCard(data, &quot;Download&quot;, &quot;logo11w.png&quot;);</div><div class="line">            </div><div class="line">if (flag) &#123;</div><div class="line">manager.notify(1, builder.build());</div><div class="line">             &#125;</div><div class="line">     &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>（2）、IntentService实现加载图片的核心代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">publicclass DownloadService extends Service &#123;</div><div class="line">privatestaticfinal String TAG = &quot;DownloadService&quot;;</div><div class="line">private String urlString = &quot;https://www.google.com.hk/images/srpr/logo11w.png&quot;;</div><div class="line">private NotificationCompat.Builder builder = null;</div><div class="line">private NotificationManager manager = null;</div><div class="line">     @Override</div><div class="line">public IBinder onBind(Intent intent) &#123;</div><div class="line">returnnull;</div><div class="line">     &#125;</div><div class="line"></div><div class="line">     @Override</div><div class="line">publicvoid onCreate() &#123;</div><div class="line">super.onCreate();</div><div class="line">manager = (NotificationManager) getSystemService(NOTIFICATION_SERVICE);</div><div class="line">builder = new NotificationCompat.Builder(getApplicationContext());</div><div class="line">builder.setSmallIcon(R.drawable.ic_launcher);</div><div class="line">builder.setContentTitle(&quot;提示：&quot;);</div><div class="line">builder.setContentText(&quot;图片加载完成，请点击查看！&quot;);</div><div class="line">builder.setTicker(&quot;图片加载完成&quot;);</div><div class="line">builder.setAutoCancel(true);</div><div class="line">             Intent intent = new Intent(getApplicationContext(), MainActivity.class);</div><div class="line">             intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);</div><div class="line">             PendingIntent pIntent = PendingIntent.getActivity(getApplicationContext(), 0, intent,</div><div class="line">             PendingIntent.FLAG_ONE_SHOT);</div><div class="line">builder.setContentIntent(pIntent);</div><div class="line">     &#125;</div><div class="line"></div><div class="line">     @Override</div><div class="line">publicint onStartCommand(Intent intent, int flags, int startId) &#123;</div><div class="line">new Thread(new Runnable() &#123;</div><div class="line">                    @Override</div><div class="line">publicvoid run() &#123;</div><div class="line">byte[] data = HttpClientHelper.loadByteFromURL(urlString);</div><div class="line">boolean flag = SDCardHelper.saveFileToSDCard(data, &quot;Download&quot;,&quot;logo11w.png&quot;);</div><div class="line">if (flag) &#123;</div><div class="line">manager.notify(1, builder.build());</div><div class="line">                                     stopSelf();</div><div class="line">                             &#125;</div><div class="line">                     &#125;</div><div class="line">             &#125;).start();</div><div class="line">returnSTART_STICKY;</div><div class="line">     &#125;</div><div class="line"></div><div class="line">     @Override</div><div class="line">publicvoid onDestroy() &#123;</div><div class="line">super.onDestroy();</div><div class="line">     &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="（二）、Bound-Service启动MediaPlayer播放音乐："><a href="#（二）、Bound-Service启动MediaPlayer播放音乐：" class="headerlink" title="（二）、Bound Service启动MediaPlayer播放音乐："></a>（二）、Bound Service启动MediaPlayer播放音乐：</h2><p>1、操作步骤：<br>1、写xml布局文件；<br>2、写MainActivity文件，构建ServiceConnection对象，重写其中的抽象方法onServiceDisconnected()和onServiceConnected()；<br>3、写继承于Service的BindService类文件，定义继承于Binder的内部类MyBinder，在其中定义方法getService()；<br>4、BindService类中重写onCreate()方法、重写onBind()回调方法，onBind()方法返回MyBinder对象，重写onDestroy()方法；</p>
<p>2、XML布局文件：同上</p>
<p>3、MainActivty核心代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line">publicclass MainActivity extends Activity &#123;</div><div class="line">privatestaticfinal String TAG = &quot;MainActivity&quot;;</div><div class="line">private Intent intent;</div><div class="line">private ServiceConnection conn = null;</div><div class="line">private BindServicePlayMusic musicService;</div><div class="line"></div><div class="line"> @Override</div><div class="line">protectedvoid onCreate(Bundle savedInstanceState) &#123;</div><div class="line">          Log.i (TAG, &quot;==onCreate执行&quot;);</div><div class="line">super.onCreate(savedInstanceState);</div><div class="line"></div><div class="line">          setContentView(R.layout.activity_main);</div><div class="line">          // 启动服务有多种写法：</div><div class="line">          // 可以通过new Intent(action字符串)来实现;</div><div class="line">          // intent = new Intent(&quot;com.steven.bindservice.playmusic&quot;);</div><div class="line">intent = new Intent(this, BindServicePlayMusic.class);</div><div class="line">conn = new ServiceConnection() &#123;</div><div class="line"> @Override</div><div class="line">publicvoid onServiceDisconnected(ComponentName name) &#123;</div><div class="line">                            musicService = null;</div><div class="line">                  &#125;</div><div class="line"></div><div class="line">                 @Override</div><div class="line">publicvoid onServiceConnected(ComponentName name, IBinder service) &#123;</div><div class="line">musicService = ((BindServicePlayMusic.MyBinder) service).getService();</div><div class="line">if (musicService != null) &#123;</div><div class="line">musicService.play();</div><div class="line">                          &#125;</div><div class="line">                  &#125;</div><div class="line">          &#125;;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">publicvoid clickButton(View view) &#123;</div><div class="line">switch (view.getId()) &#123;</div><div class="line">case R.id.button_main_play:</div><div class="line">if (musicService == null) &#123;</div><div class="line">                           bindService(intent, conn, Context.BIND_AUTO_CREATE);</div><div class="line">                   &#125; else &#123;</div><div class="line">musicService.play();</div><div class="line">                   &#125;</div><div class="line">break;</div><div class="line">case R.id.button_main_pause:</div><div class="line">if (musicService != null) &#123;</div><div class="line">musicService.pause();</div><div class="line">                  &#125;</div><div class="line">break;</div><div class="line">case R.id.button_main_stop:</div><div class="line">if (musicService != null) &#123;</div><div class="line">musicService.stop();</div><div class="line">                  &#125;</div><div class="line">break;</div><div class="line">case R.id.button_main_exit:</div><div class="line">                  finish();</div><div class="line">break;</div><div class="line">case R.id.button_main_stopservice:</div><div class="line">                  // BindService中stopService(intent)不起作用，要通过undbindService来停止服务</div><div class="line">                  // stopService(intent);</div><div class="line">                  // musicService = null的目的是如果停止服务后，再次”播放“，可以正常执行。</div><div class="line">                  // 如果不将musicService设置为null，再次播放时，将直接执行musicService.play()，</div><div class="line"> //而不执行bindService()，那么会导致异常</div><div class="line">                      musicService = null;</div><div class="line">                      unbindService(conn);</div><div class="line">break;</div><div class="line">          &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>4、BindServicePlayMusic核心代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line">publicclass BindServicePlayMusic extends Service &#123;</div><div class="line">privatestaticfinal String TAG = &quot;BindServicePlayMusic&quot;;</div><div class="line">private MediaPlayer mediaPlayer;</div><div class="line">private IBinder binder = null;</div><div class="line"></div><div class="line">     @Override</div><div class="line">publicvoid onCreate() &#123;</div><div class="line">              Log.i (TAG, &quot;==onCreate执行&quot;);</div><div class="line">super.onCreate();</div><div class="line">if (mediaPlayer == null) &#123;</div><div class="line">mediaPlayer = MediaPlayer.create(this, R.raw.heavencity);</div><div class="line">mediaPlayer.setLooping(false);</div><div class="line">              &#125;</div><div class="line">binder = new MyBinder();</div><div class="line">      &#125;</div><div class="line"></div><div class="line">class MyBinder extends Binder &#123;</div><div class="line">public BindServicePlayMusic getService() &#123;</div><div class="line">return BindServicePlayMusic.this;</div><div class="line">              &#125;</div><div class="line">      &#125;;</div><div class="line"></div><div class="line">     @Override</div><div class="line">public IBinder onBind(Intent intent) &#123;</div><div class="line">              Log.i (TAG, &quot;==onBind执行&quot;);</div><div class="line">              play();</div><div class="line">returnbinder;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">     @Override</div><div class="line">publicboolean onUnbind(Intent intent) &#123;</div><div class="line">              Log.i (TAG, &quot;==onUnbind执行&quot;);</div><div class="line">returnsuper.onUnbind(intent);</div><div class="line">      &#125;</div><div class="line"></div><div class="line">     @Override</div><div class="line">publicvoid onDestroy() &#123;</div><div class="line">              Log.i (TAG, &quot;==onDestroy执行&quot;);</div><div class="line">super.onDestroy();</div><div class="line">if (mediaPlayer != null) &#123;</div><div class="line">mediaPlayer.stop();</div><div class="line">mediaPlayer.release();</div><div class="line">              &#125;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">publicvoid play() &#123;</div><div class="line">if (!mediaPlayer.isPlaying()) &#123;</div><div class="line">mediaPlayer.start();</div><div class="line">              &#125;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">publicvoid pause() &#123;</div><div class="line">if (mediaPlayer.isPlaying()) &#123;</div><div class="line">mediaPlayer.pause();</div><div class="line">              &#125;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">publicvoid stop() &#123;</div><div class="line">if (mediaPlayer != null) &#123;</div><div class="line">mediaPlayer.stop();</div><div class="line">              &#125;</div><div class="line">      &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>5、Manifest清单配置文件核心代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&lt;service </div><div class="line"></div><div class="line">android:name=&quot;.BindServicePlayMusic&quot;&gt;</div><div class="line"></div><div class="line">&lt;intent-filter&gt;</div><div class="line">&lt;actionandroid:name=“com.steven.bindservice.playmusic&quot;/&gt;</div><div class="line">&lt;/intent-filter&gt;</div><div class="line">&lt;/service&gt;</div><div class="line"></div><div class="line">           &lt;service android:name=&quot;.BindServicePlayMusic&quot;&gt;</div><div class="line">&lt;intent-filter&gt;</div><div class="line">&lt;actionandroid:name=“com.steven.bindservice.playmusic&quot;/&gt;</div><div class="line">&lt;/intent-filter&gt;</div><div class="line">&lt;/service&gt;</div><div class="line">           &lt;service android:name=&quot;.BindServicePlayMusic&quot;&gt;</div><div class="line">&lt;intent-filter&gt;</div><div class="line">&lt;actionandroid:name=“com.steven.bindservice.playmusic&quot;/&gt;</div><div class="line">&lt;/intent-filter&gt;</div><div class="line">&lt;/service&gt;</div></pre></td></tr></table></figure>
<p>6、Bound Service总结：</p>
<h1 id="三、-拓展知识（进程和生命周期）："><a href="#三、-拓展知识（进程和生命周期）：" class="headerlink" title="三、 拓展知识（进程和生命周期）："></a>三、 拓展知识（进程和生命周期）：</h1><p>Android操作系统尝试尽可能长时间保持应用的进程，但当可用内存很低时要移走一部分进程。哪些程序可以运行，哪些要被销毁？答案是：重要级别低的进程可能被淘汰。<br>按照重要性排列，一共可以分成5级：</p>
<p>1、前台运行进程：<br>用户此时需要处理和显示的进程。符合下列条件任何一个，这个进程就被认为是前台运行进程。<br>与用户正发生交互；<br>它控制一个与用户交互的必须的基本的服务；<br>一个正在调用生命周期回调方法的ervice（如onCreate()、onStar()、onDestroy()）；<br>一个正在运行onReceive()方法的广播接收对象。<br>销毁前台运行进程是系统万不得已的、最后的选择——当内存不够系统继续运行下去时，杀掉一些前台进程来保证能够响应用户的需求。</p>
<p>2、可用进程：<br>一个可用进程没有任何前台组件，但它仍然可以影响到用户的界面。下面情况发生时，可以称该进程为可用进程。<br>        它是一个非前台的activity，但对用户仍然可用（onPause()方法已经被调用）。例如：前台的activity是一个允许上一个activity可见的对话框。也就是说当前activity中是一个对话框，对话框之外的地方能看到前一个activity的界面。</p>
<p>3、服务进程：<br>服务进程是一个通过调用startService()方法启动的服务，并且不属于前两种情况。尽管服务进程没有直接被用户看到，但他们确实是用户所关心的，比如后台播放音乐或网络下载数据，所以系统保证他们的运行。</p>
<p>4、后台进程：<br>一个后台进程就是非当前正在运行的activity（activity的onStop()方法已经被调用），他们不会对用户体验造成直接的影响，当没有足够内存来运行前台可见程序时，他们将会被终止。<br>通常，后台进程会有很多个在运行，LRU最近使用程序列表来保证经常运行的activity能最后一个被终止。</p>
<p>5、空线程：<br>一个空线程没有运行任何可用应用程序，保留他们的唯一原因是为了设立一个缓存机制，来加快组件启动的时间。系统经常杀死这些内存来平衡系统的整个系统的资源，进程缓存和基本核心缓存之间的资源。</p>
<h1 id="四、AIDL实现挂断电话："><a href="#四、AIDL实现挂断电话：" class="headerlink" title="四、AIDL实现挂断电话："></a>四、AIDL实现挂断电话：</h1><p>（一）、核心代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">publicclass InCallReceiver extends BroadcastReceiver &#123;</div><div class="line">private TelephonyManager manager = null;</div><div class="line"></div><div class="line">       @Override</div><div class="line">publicvoid onReceive(Context context, Intent intent) &#123;</div><div class="line">manager = (TelephonyManager) context .getSystemService(Service.TELEPHONY_SERVICE);</div><div class="line">              </div><div class="line">switch (manager.getCallState()) &#123;</div><div class="line">case TelephonyManager.CALL_STATE_RINGING:</div><div class="line">                       String incomingNumber = intent.getStringExtra(&quot;incoming_number&quot;);</div><div class="line">if (&quot;12345678&quot;.equals(incomingNumber)) &#123;</div><div class="line">try &#123;</div><div class="line">                                    // 获得TelephonyManager的class对象</div><div class="line">                                       Class&lt;TelephonyManager&gt; telephonyManagerClass = TelephonyManager.class;</div><div class="line">                                    // 获得TelephonyManager.getITelephony方法的Method对象</div><div class="line">                                       Method telephonyMethod = telephonyManagerClass</div><div class="line">                                                       .getDeclaredMethod(&quot;getITelephony&quot;, (Class[]) null);</div><div class="line">                                    // 允许访问私有的方法</div><div class="line">                                       telephonyMethod.setAccessible(true);</div><div class="line">                                    // 调用getITelephony()方法返回ITelephony对象</div><div class="line">                        ITelephony telephony = (com.android.internal.telephony.ITelephony) telephonyMethod</div><div class="line">                                                       .invoke(manager, (Object[]) null);</div><div class="line">                                    // 挂断电话</div><div class="line">                                       telephony.endCall();</div><div class="line">                               &#125; catch (Exception e) &#123;</div><div class="line">                                       Toast.makeText(context, e.getMessage(), Toast.LENGTH_LONG).show();</div><div class="line">                               &#125;</div><div class="line">                       &#125;</div><div class="line">break;</div><div class="line">               &#125;</div><div class="line">       &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a  href="/2015/10/02/Service/">Service</a></p>
        <p><span>文章作者:</span><a  href="/" title="访问 Pu Ming 的个人博客">Pu Ming</a></p>
        <p><span>发布时间:</span>2015年10月02日 - 20时30分</p>
        <p><span>最后更新:</span>2017年02月22日 - 18时34分</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2015/10/02/Service/" title="Service">http://yoursite.com/2015/10/02/Service/</a>
            <span class="copy-path" data-clipboard-text="原文: http://yoursite.com/2015/10/02/Service/　　作者: Pu Ming" title=""></span>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" title="中国大陆 (CC BY-NC-SA 3.0 CN)" target = "_blank">"署名-非商用-相同方式共享 3.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



<nav id="article-nav">
  
    <a  href="/2015/10/08/BroadcastReceiver/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          BroadcastReceiver
        
      </div>
    </a>
  
  
</nav>


  
</article>

    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#一、Service："><span class="toc-number">1.</span> <span class="toc-text">一、Service：</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#（一）、Service-简介："><span class="toc-number">1.1.</span> <span class="toc-text">（一）、Service 简介：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#（二）、服务的分类："><span class="toc-number">1.2.</span> <span class="toc-text">（二）、服务的分类：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#（三）、Service的生命周期："><span class="toc-number">1.3.</span> <span class="toc-text">（三）、Service的生命周期：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#二、本地Service："><span class="toc-number">2.</span> <span class="toc-text">二、本地Service：</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#（一）、Started-Service启动MediaPlayer播放音乐："><span class="toc-number">2.1.</span> <span class="toc-text">（一）、Started Service启动MediaPlayer播放音乐：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#（二）、Bound-Service启动MediaPlayer播放音乐："><span class="toc-number">2.2.</span> <span class="toc-text">（二）、Bound Service启动MediaPlayer播放音乐：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#三、-拓展知识（进程和生命周期）："><span class="toc-number">3.</span> <span class="toc-text">三、 拓展知识（进程和生命周期）：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#四、AIDL实现挂断电话："><span class="toc-number">4.</span> <span class="toc-text">四、AIDL实现挂断电话：</span></a></li></ol>
</div>
<style>
    .left-col .switch-btn {
        display: none;
    }
    .left-col .switch-area {
        display: none;
    }
</style>
<input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script>
    var valueHide = "隐藏目录";
    var valueShow = "显示目录";
    if ($(".left-col").is(":hidden")) {
        $("#tocButton").attr("value", valueShow);
    }
    $("#tocButton").click(function() {
        if ($("#toc").is(":hidden")) {
            $("#tocButton").attr("value", valueHide);
            $("#toc").slideDown(320);
            $(".switch-btn, .switch-area").fadeOut(300);
        }
        else {
            $("#tocButton").attr("value", valueShow);
            $("#toc").slideUp(350);
            $(".switch-btn, .switch-area").fadeIn(500);
        }
    })
    if ($(".toc").length < 1) {
        $("#toc, #tocButton").hide();
        $(".switch-btn, .switch-area").show();
    }
</script>




<div class="bdsharebuttonbox">
	<a href="#" class="fx fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
	<a href="#" class="fx fa-weixin bds_weixin" data-cmd="weixin" title="分享到微信"></a>
	<a href="#" class="fx fa-qq bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a>
	<a href="#" class="fx fa-facebook-official bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
	<a href="#" class="fx fa-twitter bds_twi" data-cmd="twi" title="分享到Twitter"></a>
	<a href="#" class="fx fa-linkedin bds_linkedin" data-cmd="linkedin" title="分享到linkedin"></a>
	<a href="#" class="fx fa-files-o bds_copy" data-cmd="copy" title="分享到复制网址"></a>
</div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>




    
        <section class="changyan" id="comments">
  <!--<div id="uyan_frame"></div>-->
  <div id="SOHUCS"></div>
  <script charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/changyan.js"></script>
  <script type="text/javascript">
    window.changyan.api.config({
      appid: 'xxxx',
      conf: 'xxxxxxxxx'
    });
  </script>
</section>
    



    <div class="scroll" id="post-nav-button">
        
            <a  href="/2015/10/08/BroadcastReceiver/" title="上一篇: BroadcastReceiver">
                <i class="fa fa-angle-left"></i>
            </a>
        
        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>
        
            <a  href="/" title="回到主页"><i class="fa fa-home"></i></a>
        
    </div>
    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/12/04/Android加载ReactNative页面流程/">Android加载ReactNative页面流程</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/12/Android-Multidex原理/">Android Multidex原理</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/11/结构性模式-代理模式/">结构性模式-代理模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/02/ReactNavigation/">ReactNavigation</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/02/Redux-for-ReactNative/">Redux for ReactNative</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/11/React组件生命周期/">React组件生命周期</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/26/Android嵌套RN页面/">Android嵌套RN页面</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/17/Annotation/">Java注解</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/16/Handler/">Handler机制</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/08/BroadcastReceiver/">BroadcastReceiver</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/02/Service/">Service</a></li></ul>
    <script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
    <script>
        $(".post-list").addClass("toc-article");
        // $(".post-list-item a").attr("target","_blank");
        $("#post-nav-button > a:nth-child(2)").click(function() {
            $(".fa-bars, .fa-times").toggle();
            $(".post-list").toggle(300);
            if ($(".toc").length > 0) {
                $("#toc, #tocButton").toggle(200, function() {
                    if ($(".switch-area").is(":visible")) {
                        $("#toc, .switch-btn, .switch-area").toggle();
                        $("#tocButton").attr("value", valueHide);
                        }
                    })
            }
            else {
                $(".switch-btn, .switch-area").fadeToggle(300);
            }
        })
    </script>




    <script>
        
    </script>

</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                &copy; 2017 Pu Ming
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank">Hexo &nbsp;&nbsp;</a><a href="https://github.com/maochunguang" target="_blank">Blog</a> by tommy
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" >极客到访数: 
                            <span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>, </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit">本页阅读量: 
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>

    </div>
    <script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>

    <script>
        $(document).ready(function() {
            var backgroundnum = 1;
            var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
            $("#mobile-nav").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
            $(".left-col").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
        })
    </script>


<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'xxxxx', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->



	<script>
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "//hm.baidu.com/hm.js?xxxxxx";
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>



<div class="scroll" id="scroll">
    <a href="#"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments"><i class="fa fa-comments-o"></i></a>
    <a href="#footer"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    $(document).ready(function() {
        if ($("#comments").length < 1) {
            $("#scroll > a:nth-child(2)").hide();
        };
    })
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

  <script language="javascript">
    $(function() {
        $("a[title]").each(function() {
            var a = $(this);
            var title = a.attr('title');
            if (title == undefined || title == "") return;
            a.data('title', title).removeAttr('title').hover(
            function() {
                var offset = a.offset();
                $("<div id=\"anchortitlecontainer\"></div>").appendTo($("body")).html(title).css({
                    top: offset.top - a.outerHeight() - 15,
                    left: offset.left + a.outerWidth()/2 + 1
                }).fadeIn(function() {
                    var pop = $(this);
                    setTimeout(function() {
                        pop.remove();
                    }, pop.text().length * 800);
                });
            }, function() {
                $("#anchortitlecontainer").remove();
            });
        });
    });
</script>


  </div>
</body>
</html>